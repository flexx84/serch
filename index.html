<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쇼핑몰 거래내역 조회</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Babel 경고 메시지 숨기기
        console.warn = function() {};
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f9fafb;
        }
        .min-h-screen { min-height: 100vh; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-orange-50 { background-color: #fff7ed; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .text-gray-900 { color: #111827; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-400 { color: #9ca3af; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-700 { color: #1d4ed8; }
        .text-blue-800 { color: #1e40af; }
        .text-green-600 { color: #16a34a; }
        .text-green-700 { color: #15803d; }
        .text-green-800 { color: #166534; }
        .text-red-600 { color: #dc2626; }
        .text-red-700 { color: #b91c1c; }
        .text-red-800 { color: #991b1b; }
        .text-orange-600 { color: #ea580c; }
        .text-white { color: #ffffff; }
        .border { border-width: 1px; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-blue-200 { border-color: #bfdbfe; }
        .border-green-200 { border-color: #bbf7d0; }
        .border-red-200 { border-color: #fecaca; }
        .border-orange-200 { border-color: #fed7aa; }
        .border-gray-100 { border-color: #f3f4f6; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-b { border-bottom-width: 1px; }
        .border-t { border-top-width: 1px; }
        .border-2 { border-width: 2px; }
        .border-dashed { border-style: dashed; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-full { border-radius: 9999px; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .pl-10 { padding-left: 2.5rem; }
        .pr-3 { padding-right: 0.75rem; }
        .pr-4 { padding-right: 1rem; }
        .pt-2 { padding-top: 0.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .space-y-1 > * + * { margin-top: 0.25rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .flex-1 { flex: 1 1 0%; }
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .w-8 { width: 2rem; }
        .w-12 { width: 3rem; }
        .w-16 { width: 4rem; }
        .w-full { width: 100%; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-8 { height: 2rem; }
        .h-12 { height: 3rem; }
        .h-16 { height: 4rem; }
        .h-20 { height: 5rem; }
        .max-w-md { max-width: 28rem; }
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-mono { font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace; }
        .leading-5 { line-height: 1.25rem; }
        .leading-relaxed { line-height: 1.625; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .cursor-pointer { cursor: pointer; }
        .sticky { position: sticky; }
        .fixed { position: fixed; }
        .absolute { position: absolute; }
        .relative { position: relative; }
        .top-0 { top: 0px; }
        .top-1\/2 { top: 50%; }
        .left-3 { left: 0.75rem; }
        .inset-0 { top: 0px; right: 0px; bottom: 0px; left: 0px; }
        .z-10 { z-index: 10; }
        .z-50 { z-index: 50; }
        .transform { transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
        .-translate-y-1\/2 { --tw-translate-y: -50%; }
        .transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .rotate-180 { --tw-rotate: 180deg; }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05); }
        .overflow-hidden { overflow: hidden; }
        .opacity-50 { opacity: 0.5; }
        .bg-opacity-50 { --tw-bg-opacity: 0.5; }
        .bg-black { background-color: rgb(0 0 0 / var(--tw-bg-opacity, 1)); }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-green-500 { background-color: #22c55e; }
        .bg-red-500 { background-color: #ef4444; }
        .hover\:text-gray-600:hover { color: #4b5563; }
        .focus\:ring-2:focus { box-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); }
        .focus\:ring-blue-500:focus { --tw-ring-color: #3b82f6; }
        .focus\:border-transparent:focus { border-color: transparent; }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .border-b-2 { border-bottom-width: 2px; }
        .border-blue-600 { border-color: #2563eb; }
        input, button {
            outline: none;
        }
        input:focus {
            ring: 2px solid #3b82f6;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f9fafb;">
            <div style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: bold; color: #374151; margin-bottom: 1rem;">로딩 중...</div>
                <div style="color: #6b7280;">페이지를 준비하고 있습니다</div>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 아이콘 컴포넌트들
        const SearchIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const ChevronDownIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="m19 9-7 7-7-7" />
            </svg>
        );

        const CalendarIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const EyeIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
        );

        const UploadIcon = ({ className = "w-12 h-12 text-gray-400 mx-auto mb-3" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
        );

        const FileSpreadsheetIcon = () => (
            <svg className="w-16 h-16 text-blue-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
        );

        const CheckCircleIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const XCircleIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const AlertTriangleIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
        );

        const RotateCcwIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const TransactionViewer = () => {
            const [transactions, setTransactions] = useState([]);
            const [filteredTransactions, setFilteredTransactions] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedFilter, setSelectedFilter] = useState('all');
            const [selectedCard, setSelectedCard] = useState(null);
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');
            const [showDateFilter, setShowDateFilter] = useState(false);
            const [showUpload, setShowUpload] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [isLoadingDefault, setIsLoadingDefault] = useState(true);
            const [dataLoadedFromFile, setDataLoadedFromFile] = useState(false);  // data.xlsx로 로드되었는지 추적

            // 페이지 로드 시 자동으로 data.xlsx 파일 로드
            useEffect(() => {
                loadDefaultData();
            }, []);

            const loadDefaultData = async () => {
                setIsLoadingDefault(true);
                try {
                    console.log('data.xlsx 파일 로드 시도 중...');
                    
                    // GitHub에 업로드된 data.xlsx 파일을 자동 로드
                    const response = await fetch('./data.xlsx');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: 파일을 찾을 수 없습니다`);
                    }
                    
                    const arrayBuffer = await response.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer);
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    console.log('엑셀 파일 로드 성공:', jsonData.length, '행');
                    
                    // 헤더 제거하고 실제 데이터만 추출
                    const dataRows = jsonData.slice(1)
                        .filter(row => row[0] && row[0] !== '')
                        .map(row => ({
                            no: row[0],
                            paymentDate: row[1],
                            cancelDate: row[2],
                            bank: row[3],
                            approvalNumber: row[4],
                            productName: row[5],
                            amount: parseInt(row[6]) || 0,
                            cardNumber: row[7],
                            phone: row[8],
                            status: row[9],
                            customerId: row[10]
                        }));
                    
                    console.log('처리된 데이터:', dataRows.length, '건');
                    
                    setTransactions(dataRows);
                    setFilteredTransactions(dataRows);
                    setDataLoadedFromFile(true);  // data.xlsx로 로드 성공 표시
                    
                } catch (error) {
                    console.log('data.xlsx 파일 로드 실패:', error.message);
                    console.log('업로드 모드로 전환합니다');
                    setShowUpload(true);
                } finally {
                    setIsLoadingDefault(false);
                }
            };

            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setIsLoading(true);
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer);
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    console.log('로드된 데이터:', jsonData.length, '행');
                    
                    // 헤더 제거하고 실제 데이터만 추출
                    const dataRows = jsonData.slice(1)
                        .filter(row => row[0] && row[0] !== '') // NO가 있는 행만
                        .map(row => ({
                            no: row[0],
                            paymentDate: row[1],
                            cancelDate: row[2],
                            bank: row[3],
                            approvalNumber: row[4],
                            productName: row[5],
                            amount: parseInt(row[6]) || 0,
                            cardNumber: row[7],
                            phone: row[8],
                            status: row[9],
                            customerId: row[10]
                        }));
                    
                    console.log('처리된 데이터:', dataRows.length, '건');
                    
                    setTransactions(dataRows);
                    setFilteredTransactions(dataRows);
                    setShowUpload(false);
                } catch (error) {
                    console.error('파일 업로드 실패:', error);
                    alert('파일 업로드에 실패했습니다. 올바른 엑셀 파일인지 확인해주세요.');
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => {
                applyFilters();
            }, [searchTerm, selectedFilter, startDate, endDate, transactions]);

            const applyFilters = () => {
                let filtered = [...transactions];

                // 검색 필터
                if (searchTerm) {
                    filtered = filtered.filter(t => 
                        t.productName?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        t.customerId?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        t.approvalNumber?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        t.phone?.includes(searchTerm)
                    );
                }

                // 상태 필터
                if (selectedFilter === 'approved') {
                    filtered = filtered.filter(t => t.status === '승인');
                } else if (selectedFilter === 'cancelled') {
                    filtered = filtered.filter(t => t.status === '전취소' || t.status === '후취소');
                }

                // 날짜 필터
                if (startDate || endDate) {
                    filtered = filtered.filter(t => {
                        if (!t.paymentDate) return false;
                        const paymentDate = String(t.paymentDate).substr(0, 8); // YYYYMMDD
                        const start = startDate.replace(/-/g, '');
                        const end = endDate.replace(/-/g, '');
                        
                        if (startDate && endDate) {
                            return paymentDate >= start && paymentDate <= end;
                        } else if (startDate) {
                            return paymentDate >= start;
                        } else if (endDate) {
                            return paymentDate <= end;
                        }
                        return true;
                    });
                }

                setFilteredTransactions(filtered);
            };

            const formatDate = (dateStr) => {
                if (!dateStr) return '-';
                const str = String(dateStr);
                if (str.length < 8) return str;
                const year = str.substr(0, 4);
                const month = str.substr(4, 2);
                const day = str.substr(6, 2);
                const hour = str.substr(8, 2) || '00';
                const minute = str.substr(10, 2) || '00';
                return `${year}.${month}.${day} ${hour}:${minute}`;
            };

            const formatAmount = (amount) => {
                return new Intl.NumberFormat('ko-KR').format(amount) + '원';
            };

            const getStatusColor = (status) => {
                switch(status) {
                    case '승인': return 'text-green-600 bg-green-50 border-green-200';
                    case '전취소': return 'text-red-600 bg-red-50 border-red-200';
                    case '후취소': return 'text-orange-600 bg-orange-50 border-orange-200';
                    default: return 'text-gray-600 bg-gray-50 border-gray-200';
                }
            };

            const getStatusIcon = (status) => {
                switch(status) {
                    case '승인': return <CheckCircleIcon />;
                    case '전취소': return <XCircleIcon />;
                    case '후취소': return <AlertTriangleIcon />;
                    default: return <CheckCircleIcon />;
                }
            };

            const resetFilters = () => {
                setSearchTerm('');
                setSelectedFilter('all');
                setStartDate('');
                setEndDate('');
            };

            const getTotalStats = () => {
                const approved = transactions.filter(t => t.status === '승인');
                const cancelled = transactions.filter(t => t.status === '전취소' || t.status === '후취소');
                const approvedAmount = approved.reduce((sum, t) => sum + (t.amount || 0), 0);
                const cancelledAmount = cancelled.reduce((sum, t) => sum + (t.amount || 0), 0);
                
                return { 
                    approved: approved.length, 
                    cancelled: cancelled.length, 
                    approvedAmount, 
                    cancelledAmount,
                    total: transactions.length,
                    totalAmount: approvedAmount + cancelledAmount
                };
            };

            const stats = getTotalStats();

            // 로딩 중이거나 업로드 화면
            if (isLoadingDefault) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center">
                            <div className="mb-6">
                                <FileSpreadsheetIcon />
                                <h1 className="text-2xl font-bold text-gray-900 mb-2">쇼핑몰 거래내역</h1>
                                <p className="text-gray-600">데이터를 불러오는 중입니다...</p>
                            </div>
                            <div className="flex justify-center">
                                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (showUpload && transactions.length === 0) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center">
                            <div className="mb-6">
                                <FileSpreadsheetIcon />
                                <h1 className="text-2xl font-bold text-gray-900 mb-2">쇼핑몰 거래내역</h1>
                                <p className="text-gray-600">data.xlsx 파일을 찾을 수 없습니다.</p>
                                <p className="text-sm text-gray-500 mt-2">GitHub 리포지토리에 data.xlsx 파일을 업로드하거나<br/>직접 엑셀 파일을 업로드해주세요.</p>
                            </div>
                            
                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 mb-4">
                                <UploadIcon />
                                <input
                                    type="file"
                                    accept=".xlsx,.xls"
                                    onChange={handleFileUpload}
                                    className="hidden"
                                    id="file-upload"
                                    disabled={isLoading}
                                />
                                <label
                                    htmlFor="file-upload"
                                    className={`cursor-pointer ${isLoading ? 'opacity-50' : ''}`}
                                >
                                    <div className="text-blue-600 font-medium mb-1">
                                        {isLoading ? '처리 중...' : '파일 선택하기'}
                                    </div>
                                    <div className="text-sm text-gray-500">
                                        .xlsx, .xls 파일만 지원
                                    </div>
                                </label>
                            </div>
                            
                            <div className="text-xs text-gray-500 text-left bg-gray-50 p-3 rounded">
                                <strong>필요한 컬럼:</strong><br/>
                                NO, 결제일자, 취소일자, 금융사, 승인번호, 상품명, 결제금액, 카드/계좌번호, 전화번호, 상태, 구매자(고객ID)
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* 헤더 */}
                    <div className="bg-white shadow-sm border-b sticky top-0 z-10">
                        <div className="px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-xl font-bold text-gray-900">쇼핑몰 거래내역</h1>
                                    <p className="text-sm text-gray-500">총 {filteredTransactions.length}건</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowDateFilter(!showDateFilter)}
                                        className="flex items-center gap-1 px-3 py-1 bg-blue-500 text-white rounded-lg text-sm"
                                    >
                                        <CalendarIcon />
                                        날짜조회
                                    </button>
                                    {/* data.xlsx로 로드되지 않은 경우에만 파일업로드 버튼 표시 */}
                                    {!dataLoadedFromFile && (
                                        <button
                                            onClick={() => setShowUpload(true)}
                                            className="flex items-center gap-1 px-3 py-1 bg-green-500 text-white rounded-lg text-sm"
                                        >
                                            <UploadIcon className="w-4 h-4" />
                                            파일업로드
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 통계 카드 */}
                    <div className="p-4">
                        <div className="grid grid-cols-3 gap-3 mb-4">
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <div className="flex items-center gap-2 mb-1">
                                    <EyeIcon />
                                    <span className="text-sm font-medium text-blue-700">전체</span>
                                </div>
                                <p className="text-lg font-bold text-blue-800">{stats.total}건</p>
                                <p className="text-xs text-blue-600">{formatAmount(stats.totalAmount)}</p>
                            </div>
                            <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                                <div className="flex items-center gap-2 mb-1">
                                    <CheckCircleIcon />
                                    <span className="text-sm font-medium text-green-700">승인</span>
                                </div>
                                <p className="text-lg font-bold text-green-800">{stats.approved}건</p>
                                <p className="text-xs text-green-600">{formatAmount(stats.approvedAmount)}</p>
                            </div>
                            <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                                <div className="flex items-center gap-2 mb-1">
                                    <XCircleIcon />
                                    <span className="text-sm font-medium text-red-700">취소</span>
                                </div>
                                <p className="text-lg font-bold text-red-800">{stats.cancelled}건</p>
                                <p className="text-xs text-red-600">{formatAmount(stats.cancelledAmount)}</p>
                            </div>
                        </div>
                    </div>

                    {/* 파일 업로드 모달 */}
                    {showUpload && transactions.length > 0 && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold">새 파일 업로드</h3>
                                    <button
                                        onClick={() => setShowUpload(false)}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        ✕
                                    </button>
                                </div>
                                <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                    <UploadIcon />
                                    <input
                                        type="file"
                                        accept=".xlsx,.xls"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                        id="modal-file-upload"
                                        disabled={isLoading}
                                    />
                                    <label
                                        htmlFor="modal-file-upload"
                                        className={`cursor-pointer ${isLoading ? 'opacity-50' : ''}`}
                                    >
                                        <div className="text-blue-600 font-medium mb-1">
                                            {isLoading ? '처리 중...' : '파일 선택하기'}
                                        </div>
                                        <div className="text-sm text-gray-500">
                                            새로운 엑셀 파일로 교체됩니다
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 날짜 필터 */}
                    {showDateFilter && (
                        <div className="bg-white border-b p-4 space-y-3">
                            <div className="flex items-center justify-between">
                                <h3 className="font-medium text-gray-900">기간 조회</h3>
                                <button
                                    onClick={() => setShowDateFilter(false)}
                                    className="text-gray-400 hover:text-gray-600"
                                >
                                    ✕
                                </button>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-sm text-gray-600 mb-1">시작일</label>
                                    <input
                                        type="date"
                                        value={startDate}
                                        onChange={(e) => setStartDate(e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-200 rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm text-gray-600 mb-1">종료일</label>
                                    <input
                                        type="date"
                                        value={endDate}
                                        onChange={(e) => setEndDate(e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-200 rounded-lg"
                                    />
                                </div>
                            </div>
                            <button
                                onClick={resetFilters}
                                className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 text-gray-600 rounded-lg"
                            >
                                <RotateCcwIcon />
                                필터 초기화
                            </button>
                        </div>
                    )}

                    {/* 검색 및 필터 */}
                    <div className="bg-white border-b p-4 space-y-3">
                        {/* 검색바 */}
                        <div className="relative">
                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <SearchIcon />
                            </div>
                            <input
                                type="text"
                                placeholder="상품명, 고객ID, 승인번호, 전화번호 검색..."
                                className="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>

                        {/* 필터 버튼 */}
                        <div className="flex space-x-2">
                            <button
                                onClick={() => setSelectedFilter('all')}
                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${
                                    selectedFilter === 'all' 
                                        ? 'bg-blue-500 text-white' 
                                        : 'bg-gray-100 text-gray-600'
                                }`}
                            >
                                <EyeIcon />
                                전체
                            </button>
                            <button
                                onClick={() => setSelectedFilter('approved')}
                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${
                                    selectedFilter === 'approved' 
                                        ? 'bg-green-500 text-white' 
                                        : 'bg-gray-100 text-gray-600'
                                }`}
                            >
                                <CheckCircleIcon />
                                승인
                            </button>
                            <button
                                onClick={() => setSelectedFilter('cancelled')}
                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${
                                    selectedFilter === 'cancelled' 
                                        ? 'bg-red-500 text-white' 
                                        : 'bg-gray-100 text-gray-600'
                                }`}
                            >
                                <XCircleIcon />
                                취소
                            </button>
                        </div>
                    </div>

                    {/* 거래 목록 */}
                    <div className="p-4 space-y-3">
                        {filteredTransactions.map((transaction, index) => (
                            <div
                                key={`${transaction.no}-${index}`}
                                className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"
                            >
                                {/* 메인 카드 */}
                                <div
                                    className="p-4 cursor-pointer"
                                    onClick={() => setSelectedCard(selectedCard === index ? null : index)}
                                >
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="flex-1 pr-3">
                                            <div className="flex items-start justify-between mb-2">
                                                <span className="text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                                    #{transaction.no}
                                                </span>
                                                <div className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${getStatusColor(transaction.status)}`}>
                                                    {getStatusIcon(transaction.status)}
                                                    {transaction.status}
                                                </div>
                                            </div>
                                            <h3 className="font-semibold text-gray-900 line-clamp-2 leading-5 mb-2">
                                                {transaction.productName}
                                            </h3>
                                            <div className="space-y-1">
                                                <p className="text-sm text-gray-600">
                                                    📅 {formatDate(transaction.paymentDate)}
                                                </p>
                                                <p className="text-sm text-gray-600">
                                                    👤 {transaction.customerId}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-xl font-bold text-gray-900 mb-1">
                                                {formatAmount(transaction.amount)}
                                            </p>
                                            <p className="text-sm text-gray-500">{transaction.bank}</p>
                                        </div>
                                    </div>

                                    {/* 확장 표시 */}
                                    <div className="flex justify-center pt-2 border-t border-gray-100">
                                        <ChevronDownIcon 
                                            className={`w-5 h-5 text-gray-400 transition-transform ${
                                                selectedCard === index ? 'rotate-180' : ''
                                            }`}
                                        />
                                    </div>
                                </div>

                                {/* 상세 정보 (확장) */}
                                {selectedCard === index && (
                                    <div className="border-t border-gray-100 bg-gray-50 p-4">
                                        <h4 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                                            <EyeIcon />
                                            상세 정보
                                        </h4>
                                        
                                        <div className="space-y-3">
                                            {/* 기본 정보 */}
                                            <div className="bg-white rounded-lg p-3 space-y-2">
                                                <div className="grid grid-cols-2 gap-3 text-sm">
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">거래번호</span>
                                                        <p className="font-semibold text-gray-900">#{transaction.no}</p>
                                                    </div>
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">승인번호</span>
                                                        <p className="font-mono text-gray-900">{transaction.approvalNumber}</p>
                                                    </div>
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">금융사</span>
                                                        <p className="text-gray-900">{transaction.bank}</p>
                                                    </div>
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">상태</span>
                                                        <div className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs ${getStatusColor(transaction.status)}`}>
                                                            {getStatusIcon(transaction.status)}
                                                            {transaction.status}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* 결제 정보 */}
                                            <div className="bg-white rounded-lg p-3 space-y-2">
                                                <h5 className="font-medium text-gray-900 mb-2">결제 정보</h5>
                                                <div className="space-y-2 text-sm">
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">카드/계좌번호</span>
                                                        <p className="font-mono text-gray-900">{transaction.cardNumber}</p>
                                                    </div>
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">결제금액</span>
                                                        <p className="text-lg font-bold text-blue-600">{formatAmount(transaction.amount)}</p>
                                                    </div>
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">결제일시</span>
                                                        <p className="text-gray-900">{formatDate(transaction.paymentDate)}</p>
                                                    </div>
                                                    {transaction.cancelDate && (
                                                        <div>
                                                            <span className="block text-red-600 font-medium">취소일시</span>
                                                            <p className="text-red-600">{formatDate(transaction.cancelDate)}</p>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            {/* 고객 정보 */}
                                            <div className="bg-white rounded-lg p-3 space-y-2">
                                                <h5 className="font-medium text-gray-900 mb-2">고객 정보</h5>
                                                <div className="grid grid-cols-1 gap-2 text-sm">
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">고객ID</span>
                                                        <p className="text-gray-900">{transaction.customerId}</p>
                                                    </div>
                                                    <div>
                                                        <span className="block text-gray-500 font-medium">연락처</span>
                                                        <p className="text-gray-900">{transaction.phone}</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* 상품 정보 */}
                                            <div className="bg-white rounded-lg p-3">
                                                <h5 className="font-medium text-gray-900 mb-2">상품 정보</h5>
                                                <p className="text-gray-900 leading-relaxed">{transaction.productName}</p>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}

                        {filteredTransactions.length === 0 && transactions.length > 0 && (
                            <div className="text-center py-12">
                                <div className="text-gray-400 mb-3 flex justify-center">
                                    <SearchIcon />
                                </div>
                                <p className="text-gray-500 text-lg font-medium">검색 결과가 없습니다</p>
                                <p className="text-gray-400 text-sm mt-1">다른 검색어나 필터를 시도해보세요</p>
                            </div>
                        )}
                    </div>

                    {/* 하단 여백 */}
                    <div className="h-20"></div>
                </div>
            );
        };

        // React 컴포넌트 렌더링
        setTimeout(() => {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(TransactionViewer));
        }, 100);
    </script>
</body>
</html>
